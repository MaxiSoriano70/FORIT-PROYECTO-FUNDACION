server {
  listen 80;              # Nginx escucha en el puerto 80 dentro del contenedor
  server_name _;          # Acepta cualquier dominio

  root /usr/share/nginx/html;  # Carpeta donde está la app Angular construida
  index index.html;            # Archivo principal a servir

  # ================================
  # SERVIR ARCHIVOS ESTÁTICOS (Angular)
  # ================================
  location / {
    # Busca el archivo solicitado, y si no existe,
    # devuelve index.html para que Angular maneje las rutas.
    try_files $uri $uri/ /index.html;
  }

  # ================================
  # PROXY PARA LAS PETICIONES A LA API
  # ================================
  location /api/ {

    # Redirige las peticiones /api/ hacia el backend dentro del docker-compose
    # "backend" es el nombre del servicio del backend en docker-compose.yml
    proxy_pass http://backend:8080;

    # Configuración estándar para mantener conexión estable con Node.js
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;

    # Evita cacheo durante upgrades (útil si backend usa websockets o SSE)
    proxy_cache_bypass $http_upgrade;
  }
}
